#!/bin/bash

# Sets the new version number
new_version=$(date +"%Y.%m.%d.%H%M")

# Detects current OS
if [[ "$OSTYPE" == "darwin"* ]]; then
    # macOS (uses -i '' to replace all occurrences)
    sed -i '' "s/@version      [0-9]\{4\}\.[0-9]\{2\}\.[0-9]\{2\}\.[0-9]\{4\}/@version      $new_version/" summarize-with-ai.user.js
else
    # Linux (uses -i)
    sed -i "s/@version      [0-9]\{4\}\.[0-9]\{2\}\.[0-9]\{2\}\.[0-9]\{4\}/@version      $new_version/" summarize-with-ai.user.js
fi

# Adds the modified file
git add summarize-with-ai.user.js

# Commits the changes
git commit -m "Update version number to $new_version"

# Verify the changes
if [ $? -ne 0 ]; then
    echo "Commit failed. Please check the changes and try again."
    exit 1
fi
